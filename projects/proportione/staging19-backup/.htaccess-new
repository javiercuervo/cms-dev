# =====================================================
# PROPORTIONE - Redirecciones 301 Migración 2026
# Fecha: 2026-01-31
# COLOCAR ANTES de todos los otros bloques
# =====================================================

<IfModule mod_rewrite.c>
RewriteEngine On

# --- Exclusiones (no redirigir) ---
RewriteCond %{REQUEST_URI} ^/wp-admin [NC,OR]
RewriteCond %{REQUEST_URI} ^/wp-login\.php [NC,OR]
RewriteCond %{REQUEST_URI} ^/wp-json [NC,OR]
RewriteCond %{REQUEST_URI} ^/xmlrpc\.php [NC,OR]
RewriteCond %{REQUEST_URI} \.(css|js|jpg|jpeg|png|gif|ico|svg|woff|woff2|ttf|eot)$ [NC]
RewriteRule ^ - [L]

# =====================================================
# REDIRECCIONES 301 (orden: más específica primero)
# =====================================================

# Estrategia de innovación (slug largo → corto)
RewriteCond %{REQUEST_URI} ^/transformacion-e-innovacion-una-guia-para-el-futuro/estrategia-de-innovacion-una-guia-para-el-futuro/?$ [NC]
RewriteRule ^ /estrategia-innovacion/ [R=301,L]

# IA Generativa (simplificación slug)
RewriteCond %{REQUEST_URI} ^/inteligencia-artificial-generativa/?$ [NC]
RewriteRule ^ /ia-generativa/ [R=301,L]

# Estrategia omnicanal retail (simplificación slug)
RewriteCond %{REQUEST_URI} ^/estrategia-omnicanal-el-camino-hacia-la-coherencia-en-el-comercio-minorista/?$ [NC]
RewriteRule ^ /estrategia-omnicanal-retail/ [R=301,L]

# Filosofía (antes divina-proportione)
RewriteCond %{REQUEST_URI} ^/estrategia-tecnologia-y-personas/divina-proportione/?$ [NC]
RewriteRule ^ /filosofia/ [R=301,L]

# Clientes (antes resultados-clientes)
RewriteCond %{REQUEST_URI} ^/estrategia-tecnologia-y-personas/resultados-clientes/?$ [NC]
RewriteRule ^ /clientes/ [R=301,L]

# Investigación (simplificación slug)
RewriteCond %{REQUEST_URI} ^/investigacion-tesis-universidade-de-aveiro/?$ [NC]
RewriteRule ^ /investigacion/ [R=301,L]

# Consultoría de negocio (slug largo → corto)
RewriteCond %{REQUEST_URI} ^/consultoria-estrategica-crecimiento-organico/consultoria-de-gestion-de-negocio-un-enfoque-estrategico/?$ [NC]
RewriteRule ^ /consultoria-negocio/ [R=301,L]

# Consolidación páginas padre → Servicios
RewriteCond %{REQUEST_URI} ^/consultoria-estrategica-crecimiento-organico/?$ [NC]
RewriteRule ^ /servicios/ [R=301,L]

RewriteCond %{REQUEST_URI} ^/transformacion-e-innovacion-una-guia-para-el-futuro/?$ [NC]
RewriteRule ^ /servicios/ [R=301,L]

</IfModule>
# =====================================================
# FIN REDIRECCIONES 301 PROPORTIONE
# =====================================================

# =====================================================
# REWRITES INTERNOS - Páginas PHP Custom
# =====================================================

<IfModule mod_rewrite.c>
RewriteEngine On
RewriteCond %{REQUEST_URI} ^/$
RewriteRule ^$ /index-new.php [L]
RewriteCond %{REQUEST_URI} ^/nosotros/?$
RewriteRule ^nosotros/?$ /nosotros.php [L]
RewriteCond %{REQUEST_URI} ^/metodologia/?$
RewriteRule ^metodologia/?$ /metodologia.php [L]
RewriteCond %{REQUEST_URI} ^/servicios/?$
RewriteRule ^servicios/?$ /servicios.php [L]
RewriteCond %{REQUEST_URI} ^/consultoria-gestion-negocio/?$
RewriteRule ^consultoria-gestion-negocio/?$ /consultoria-negocio.php [L]
RewriteCond %{REQUEST_URI} ^/consultoria-negocio/?$
RewriteRule ^consultoria-negocio/?$ /consultoria-negocio.php [L]
RewriteCond %{REQUEST_URI} ^/blog/?$
RewriteRule ^blog/?$ /blog.php [L]
RewriteCond %{REQUEST_URI} ^/estrategia-innovacion/?$
RewriteRule ^estrategia-innovacion/?$ /estrategia-innovacion.php [L]
RewriteCond %{REQUEST_URI} ^/clientes/?$
RewriteRule ^clientes/?$ /clientes.php [L]
RewriteCond %{REQUEST_URI} ^/investigacion/?$
RewriteRule ^investigacion/?$ /investigacion.php [L]
RewriteCond %{REQUEST_URI} ^/filosofia/?$
RewriteRule ^filosofia/?$ /filosofia.php [L]
RewriteCond %{REQUEST_URI} ^/ia-generativa/?$
RewriteRule ^ia-generativa/?$ /ia-generativa.php [L]
RewriteCond %{REQUEST_URI} ^/estrategia-omnicanal-retail/?$
RewriteRule ^estrategia-omnicanal-retail/?$ /estrategia-omnicanal-retail.php [L]
</IfModule>

<IfModule mod_rewrite.c>
RewriteEngine On
RewriteCond %{HTTP_USER_AGENT} MultiLipi-Path-Validator [NC]
RewriteRule .* - [F,L]
</IfModule>

#<Limit HEAD>
#  Order allow,deny
#  Deny from all
#</Limit>

# BEGIN HMWP_RULES
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteRule ^([_0-9a-zA-Z-]+/)?storage/f0c7ace559/(.*) /storage/siteground-optimizer-assets/$2 [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?ajax-call$ /wp-admin/admin-ajax.php [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?ghost-admin/(.*) /wp-admin/$2 [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?ghost-login$ /wp-login.php [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?ghost-login/(.*) /wp-login.php$2 [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?lostpass$ /wp-login.php?action=lostpassword [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?register$ /wp-login.php?action=register [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?disconnect$ /wp-login.php?action=logout [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?core/modules/a58e0900f8/(.*) /wp-content/plugins/autocommentai/$2 [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?core/modules/eff62dc594/(.*) /wp-content/plugins/cookie-notice/$2 [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?core/modules/8707efa35f/(.*) /wp-content/plugins/duplicate-page/$2 [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?core/modules/1a60a0f6ed/(.*) /wp-content/plugins/google-site-kit/$2 [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?core/modules/d0f4711431/(.*) /wp-content/plugins/hide-my-wp/$2 [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?core/modules/618be400f0/(.*) /wp-content/plugins/sg-cachepress/$2 [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?core/modules/456fb9997f/(.*) /wp-content/plugins/stackable-ultimate-gutenberg-blocks/$2 [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?core/modules/9c8628c6cf/(.*) /wp-content/plugins/translatepress-business/$2 [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?core/modules/2b8cd407ae/(.*) /wp-content/plugins/translatepress-multilingual/$2 [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?core/modules/16f9de4b26/(.*) /wp-content/plugins/webp-express/$2 [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?core/modules/f9c7f63a6a/(.*) /wp-content/plugins/wordpress-seo/$2 [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?core/modules/ecefbf3ab8/(.*) /wp-content/plugins/wp-reset/$2 [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?core/modules/(.*) /wp-content/plugins/$2 [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?core/views/43d5302ab6/design.css$ /wp-content/themes/twentytwentythree-child/style.css [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?core/views/43d5302ab6/(.*) /wp-content/themes/twentytwentythree-child/$2 [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?core/views/(.*) /wp-content/themes/$2 [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?storage/(.*) /wp-content/uploads/$2 [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?core/(.*) /wp-content/$2 [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?lib/(.*) /wp-includes/$2 [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?comments/(.*) /wp-comments-post.php$2 [QSA,NC,L]
RewriteRule ^([_0-9a-zA-Z-]+/)?writer/(.*) /author/$2 [QSA,NC,L]
</IfModule>
# END HMWP_RULES
# BEGIN HMWP_VULNERABILITY
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteCond %{REQUEST_URI} !/wp-admin [NC]
RewriteCond %{QUERY_STRING} ^author=\d+ [NC]
RewriteRule ^(.*)$ - [L,R=404]
</IfModule>
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteCond %{REMOTE_ADDR} ^35.214.130.87$ [NC,OR]
RewriteCond %{REMOTE_ADDR} ^192.185.4.40$ [NC,OR]
RewriteCond %{REMOTE_ADDR} ^15.235.50.223$ [NC,OR]
RewriteCond %{REMOTE_ADDR} ^172.105.48.130$ [NC,OR]
RewriteCond %{REMOTE_ADDR} ^167.99.233.123$ [NC,OR]
RewriteCond %{HTTP_USER_AGENT} (wpthemedetector|builtwith|isitwp|wapalyzer|mShots|WhatCMS|gochyu|wpdetector|scanwp) [NC]
RewriteRule ^(.*)$ - [L,R=404]
</IfModule>
<IfModule mod_headers.c>
Header always unset x-powered-by
Header always unset server
ServerSignature Off
</IfModule>
<IfModule mod_headers.c>
Header set Strict-Transport-Security "max-age=15768000;includeSubdomains"
Header set Content-Security-Policy "object-src 'none'"
Header set X-XSS-Protection "1; mode=block"
</IfModule>
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
RewriteCond %{HTTP:Cookie} !(wordpress_logged_in_|hmwp_logged_in_) [NC]
RewriteCond %{REQUEST_URI} ^/wp-content/?$ [NC,OR]
RewriteCond %{REQUEST_URI} ^/wp-content/[^\.]+/?$ [NC,OR]
RewriteCond %{THE_REQUEST} /wp-includes/?$ [NC,OR]
RewriteCond %{THE_REQUEST} /wp-content/plugins/[^\.]+(\\.php|\\.htm|\\.html|\\.rtf|\\.rtx|\\.txt|\\.lock) [NC,OR]
RewriteCond %{THE_REQUEST} /wp-content/themes/[^\.]+(\\.php|\\.htm|\\.html|\\.rtf|\\.rtx|\\.txt|\\.lock)    [NC,OR]
RewriteCond %{THE_REQUEST} /wp-content/uploads/[^\.]+(\\.php|\\.htm|\\.html|\\.rtf|\\.rtx|\\.txt|\\.lock) [NC,OR]
RewriteCond %{THE_REQUEST} /wp-includes/[^\.]+(\\.php|\\.htm|\\.html|\\.rtf|\\.rtx|\\.txt|\\.lock) [NC,OR]
RewriteCond %{THE_REQUEST} /([_0-9a-zA-Z-]+/)?(wp-config-sample\\.php|readme\\.html|readme\\.txt|install\\.php|license\\.txt|php\\.ini|bb-config\\.php|error_log) [NC]
RewriteRule ^(.*)$ - [L,R=404]
</IfModule>
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteCond %{REQUEST_URI} /(wp-config-sample\\.php|readme\\.html|readme\\.txt|install\\.php|license\\.txt|php\\.ini|bb-config\\.php|error_log) [NC]
RewriteRule ^(.*)$ - [L,R=404]
</IfModule>
# END HMWP_VULNERABILITY

# HTTPS forced by SG-Optimizer
<IfModule mod_rewrite.c>
    RewriteEngine On

    RewriteCond %{HTTP:X-Forwarded-Proto} !https
    RewriteCond %{HTTPS} off
    RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</IfModule>
# END HTTPS

# BEGIN WordPress
# Las directivas (líneas) entre «BEGIN WordPress» y «END WordPress» son
# generadas dinámicamente y solo deberían ser modificadas mediante filtros de WordPress.
# Cualquier cambio en las directivas que hay entre esos marcadores serán sobrescritas.
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
RewriteBase /
RewriteRule ^index\.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule>

# END WordPress
# SGO Unset Vary
  Header unset Vary
# SGO Unset Vary END
# BEGIN FRedirect_ErrorDocument
# Las directivas (líneas) entre «BEGIN FRedirect_ErrorDocument» y «END FRedirect_ErrorDocument» son
# generadas dinámicamente y solo deberían ser modificadas mediante filtros de WordPress.
# Cualquier cambio en las directivas que hay entre esos marcadores serán sobrescritas.
ErrorDocument 404 /index.php?error=404
# END FRedirect_ErrorDocument
